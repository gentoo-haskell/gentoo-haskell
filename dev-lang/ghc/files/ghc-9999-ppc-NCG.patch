https://gitlab.haskell.org/ghc/ghc/-/commit/3effd27d7e3c8366f81b12f514b342bd067b2d29.patch

From 3effd27d7e3c8366f81b12f514b342bd067b2d29 Mon Sep 17 00:00:00 2001
From: Peter Trommler <ptrommler@acm.org>
Date: Thu, 10 Jun 2021 11:58:16 +0200
Subject: [PATCH] PPC NCG: Fix panic in linear register allocator

---
 compiler/GHC/CmmToAsm/Reg/Linear/PPC.hs | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/compiler/GHC/CmmToAsm/Reg/Linear/PPC.hs b/compiler/GHC/CmmToAsm/Reg/Linear/PPC.hs
index e6c60155408..1e9a49f8a60 100644
--- a/compiler/GHC/CmmToAsm/Reg/Linear/PPC.hs
+++ b/compiler/GHC/CmmToAsm/Reg/Linear/PPC.hs
@@ -46,9 +46,9 @@ initFreeRegs platform = foldl' (flip releaseReg) noFreeRegs (allocatableRegs pla
 
 getFreeRegs :: RegClass -> FreeRegs -> [RealReg]        -- lazily
 getFreeRegs cls (FreeRegs g f)
+    | RcFloat <- cls = [] -- no float regs on PowerPC, use double
     | RcDouble <- cls = go f (0x80000000) 63
     | RcInteger <- cls = go g (0x80000000) 31
-    | otherwise = pprPanic "RegAllocLinear.getFreeRegs: Bad register class" (ppr cls)
     where
         go _ 0 _ = []
         go x m i | x .&. m /= 0 = RealRegSingle i : (go x (m `shiftR` 1) $! i-1)
-- 
GitLab

