# Copyright 1999-2024 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=8

# ebuild generated by hackport 0.8.5.1.9999

CABAL_FEATURES="lib profile haddock hoogle hscolour test-suite"
inherit haskell-cabal

DESCRIPTION="ghc toolchain installer"
HOMEPAGE="https://github.com/haskell/ghcup-hs"

LICENSE="LGPL-3"
SLOT="0/${PV}"
KEYWORDS="~amd64"
IUSE="internal-downloader no-exe tar +tui"

PATCHES=(
	"${FILESDIR}/${PN}-0.1.30.0-loosen-filepath.patch"
	"${FILESDIR}/${PN}-0.1.30.0-loosen-text.patch"
)

RDEPEND="
	>=dev-haskell/aeson-1.4:=[profile?]
	>=dev-haskell/aeson-pretty-0.8.8:=[profile?] <dev-haskell/aeson-pretty-0.9:=[profile?]
	>=dev-haskell/async-2.2.3:=[profile?] <dev-haskell/async-2.3:=[profile?]
	>=dev-haskell/base16-bytestring-0.1.1.6:=[profile?] <dev-haskell/base16-bytestring-1.1:=[profile?]
	>=dev-haskell/bz2-1.0.1.1:=[profile?] <dev-haskell/bz2-1.1:=[profile?]
	>=dev-haskell/cabal-3.0.0.0:=[profile?] <dev-haskell/cabal-3.11:=[profile?]
	>=dev-haskell/cabal-syntax-3.6.0.0:=[profile?] <dev-haskell/cabal-syntax-3.13:=[profile?]
	>=dev-haskell/case-insensitive-1.2.1.0:=[profile?] <dev-haskell/case-insensitive-1.3:=[profile?]
	>=dev-haskell/casing-0.1.4.1:=[profile?] <dev-haskell/casing-0.2:=[profile?]
	>=dev-haskell/conduit-1.3:=[profile?] <dev-haskell/conduit-1.4:=[profile?]
	>=dev-haskell/cryptohash-sha256-0.11.101.0:=[profile?] <dev-haskell/cryptohash-sha256-0.12:=[profile?]
	>=dev-haskell/disk-free-space-0.1.0.1:=[profile?] <dev-haskell/disk-free-space-0.2:=[profile?]
	>=dev-haskell/file-uri-0.1.0.0:=[profile?] <dev-haskell/file-uri-0.2:=[profile?]
	>=dev-haskell/haskus-utils-types-1.5:=[profile?] <dev-haskell/haskus-utils-types-1.6:=[profile?]
	>=dev-haskell/haskus-utils-variant-3.3:=[profile?] <dev-haskell/haskus-utils-variant-3.4:=[profile?]
	>=dev-haskell/lzma-static-5.2.5.3:=[profile?] <dev-haskell/lzma-static-5.3:=[profile?]
	>=dev-haskell/megaparsec-8.0.0:=[profile?] <dev-haskell/megaparsec-9.3:=[profile?]
	>=dev-haskell/optics-0.4:=[profile?] <dev-haskell/optics-0.5:=[profile?]
	>=dev-haskell/optparse-applicative-0.15.1.0:=[profile?] <dev-haskell/optparse-applicative-0.18:=[profile?]
	>=dev-haskell/os-release-1.0.0:=[profile?] <dev-haskell/os-release-1.1:=[profile?]
	dev-haskell/parsec:=[profile?]
	>=dev-haskell/pretty-terminal-0.1.0.0:=[profile?] <dev-haskell/pretty-terminal-0.2:=[profile?]
	>=dev-haskell/regex-posix-0.96:=[profile?] <dev-haskell/regex-posix-0.97:=[profile?]
	>=dev-haskell/resourcet-1.2.2:=[profile?] <dev-haskell/resourcet-1.3:=[profile?]
	>=dev-haskell/retry-0.8.1.2:=[profile?] <dev-haskell/retry-0.10:=[profile?]
	>=dev-haskell/safe-0.3.18:=[profile?] <dev-haskell/safe-0.4:=[profile?]
	>=dev-haskell/safe-exceptions-0.1:=[profile?] <dev-haskell/safe-exceptions-0.2:=[profile?]
	>=dev-haskell/split-0.2.3.4:=[profile?] <dev-haskell/split-0.3:=[profile?]
	>=dev-haskell/strict-base-0.4:=[profile?] <dev-haskell/strict-base-0.5:=[profile?]
	>=dev-haskell/tagsoup-0.14:=[profile?] <dev-haskell/tagsoup-0.15:=[profile?]
	>=dev-haskell/temporary-1.3:=[profile?] <dev-haskell/temporary-1.4:=[profile?]
	>=dev-haskell/terminal-size-0.3.3:=[profile?] <dev-haskell/terminal-size-0.4:=[profile?]
	>=dev-haskell/text-1.2.5:=[profile?]
	>=dev-haskell/unix-bytestring-0.3.7.3:=[profile?] <dev-haskell/unix-bytestring-0.4:=[profile?]
	>=dev-haskell/unliftio-core-0.2.0.1:=[profile?] <dev-haskell/unliftio-core-0.3:=[profile?]
	>=dev-haskell/unordered-containers-0.2.10.0:=[profile?] <dev-haskell/unordered-containers-0.3:=[profile?]
	>=dev-haskell/uri-bytestring-0.3.2.2:=[profile?] <dev-haskell/uri-bytestring-0.4:=[profile?]
	>=dev-haskell/utf8-string-1.0:=[profile?] <dev-haskell/utf8-string-1.1:=[profile?]
	>=dev-haskell/vector-0.12:=[profile?] <dev-haskell/vector-0.14:=[profile?]
	>=dev-haskell/versions-6.0.5:=[profile?] <dev-haskell/versions-6.1:=[profile?]
	>=dev-haskell/word8-0.1.3:=[profile?] <dev-haskell/word8-0.2:=[profile?]
	>=dev-haskell/yaml-0.11.0:=[profile?] <dev-haskell/yaml-0.12:=[profile?]
	>=dev-haskell/zlib-0.6.2.2:=[profile?] <dev-haskell/zlib-0.7:=[profile?]
	>=dev-lang/ghc-9.0.2:=
	internal-downloader? (
		>=dev-haskell/hsopenssl-0.11.7.2:=[profile?]
		>=dev-haskell/http-io-streams-0.1.2.0:=[profile?]
		>=dev-haskell/io-streams-1.5.2.1:=[profile?]
		>=dev-haskell/terminal-progress-bar-0.4.1:=[profile?]
	)
	tar? (
		>=dev-haskell/tar-0.6.0.0:=[profile?] <dev-haskell/tar-0.7:=[profile?]
		>=dev-haskell/zip-2.0.0:=[profile?] <dev-haskell/zip-2.1:=[profile?]
	)
	!tar? (
		>=dev-haskell/libarchive-3.0.3.0:=[profile?] <dev-haskell/libarchive-3.1:=[profile?]
	)
	tui? (
		>=dev-haskell/brick-2.1:=[profile?] <dev-haskell/brick-2.2:=[profile?]
		>=dev-haskell/vty-6.0:=[profile?] <dev-haskell/vty-6.3:=[profile?]
	)
"
DEPEND="${RDEPEND}
	>=dev-haskell/cabal-3.4.1.0
	test? (
		>=dev-haskell/hspec-2.7.10 <dev-haskell/hspec-2.11
		>=dev-haskell/hspec-golden-aeson-0.9 <dev-haskell/hspec-golden-aeson-0.10
		>=dev-haskell/quickcheck-2.14.1 <dev-haskell/quickcheck-2.15
		>=dev-haskell/quickcheck-arbitrary-adt-0.3.1.0 <dev-haskell/quickcheck-arbitrary-adt-0.4
		dev-haskell/tasty
		dev-haskell/tasty-hunit
		|| (
			( >=dev-haskell/generic-arbitrary-0.1.0 <dev-haskell/generic-arbitrary-0.2.1 )
			( >=dev-haskell/generic-arbitrary-0.2.2 <dev-haskell/generic-arbitrary-0.3 )
		)
	)
"

src_configure() {
	haskell-cabal_src_configure \
		$(cabal_flag internal-downloader internal-downloader) \
		$(cabal_flag no-exe no-exe) \
		$(cabal_flag tar tar) \
		$(cabal_flag tui tui)
}
