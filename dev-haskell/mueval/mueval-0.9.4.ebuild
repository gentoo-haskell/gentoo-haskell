# Copyright 1999-2025 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=8

# ebuild generated by hackport 0.9.0.0.9999

CABAL_HACKAGE_REVISION=3

CABAL_FEATURES="lib profile haddock hoogle hscolour test-suite"
inherit haskell-cabal

DESCRIPTION="Safely evaluate pure Haskell expressions"
HOMEPAGE="https://github.com/TerenceNg03/mueval#readme"

LICENSE="BSD"
SLOT="0/${PV}"
KEYWORDS="~amd64"

CABAL_CHDEPS=(
	'Cabal >=3.8.1.0 && <3.15' 'Cabal >=3.8.1.0'
	'mtl >=2.2.2 && <2.4' 'mtl >=2.2.2'
	'unix >=2.7.3 && <2.9' 'unix >=2.7.3'
	)

RDEPEND=">=dev-haskell/cabal-3.8.1.0:=[profile?] <dev-haskell/cabal-3.15:=[profile?]
	>=dev-haskell/extensible-exceptions-0.1.1.4:=[profile?] <dev-haskell/extensible-exceptions-0.2:=[profile?]
	>=dev-haskell/hint-0.9.0.7:=[profile?] <dev-haskell/hint-0.10:=[profile?]
	>=dev-haskell/quickcheck-2.14.3:=[profile?] <dev-haskell/quickcheck-2.16:=[profile?]
	>=dev-haskell/show-0.6:=[profile?] <dev-haskell/show-0.7:=[profile?]
	>=dev-haskell/simple-reflect-0.3.3:=[profile?] <dev-haskell/simple-reflect-0.4:=[profile?]
	>=dev-lang/ghc-9.4.5:=
"
DEPEND="${RDEPEND}
	>=dev-haskell/cabal-3.8.1.0
"
# default mueval timeout. in 0.7-second units
# Handy to change as lambdabot does not
# allow this bit to configure
: ${MUEVAL_TIMEOUT:=5}

CABAL_EXTRA_BUILD_FLAGS+=" --ghc-options=-rtsopts"

#src_prepare() {
#	default

	#einfo "Using default mueval timeout: ${MUEVAL_TIMEOUT} * 0.7s"
	#sed -e "s@timeLimit = 5@timeLimit = ${MUEVAL_TIMEOUT}@" \
	#	-i "${S}"/Mueval/ArgsParse.hs || die
#}

src_install() {
	cabal_src_install
	# uses GHC-api which needs mmap('rwx') (bug #299709)
	pax-mark -m "${ED}/usr/bin/mueval-core"
}
