# Copyright 1999-2011 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header:  $

# ebuild generated by hackport 0.2.13

EAPI="3"

CABAL_FEATURES="lib profile haddock hscolour hoogle"
inherit git-2 haskell-cabal

T_PV=0.6.3
S_PV=0.6.2

DESCRIPTION="Tests for Persistent"
HOMEPAGE="http://www.yesodweb.com/book/persistent"
EGIT_REPO_URI="git://github.com/yesodweb/persistent.git"
EGIT_NOUNPACK="1"
SRC_URI="test? ( http://hackage.haskell.org/packages/archive/persistent-template/${T_PV}/persistent-template-${T_PV}.tar.gz )"
SRC_URI="$SRC_URI test? ( http://hackage.haskell.org/packages/archive/persistent-sqlite/${S_PV}/persistent-sqlite-${S_PV}.tar.gz )"

EGIT_SOURCEDIR="${WORKDIR}/persistent"
S="${EGIT_SOURCEDIR}/${PN}"

LICENSE="BSD"
SLOT="0"
KEYWORDS="~amd64 ~x86"
IUSE="sqlite3 test"

RDEPEND="dev-haskell/blaze-html
		>=dev-haskell/bson-0.1.6
		dev-haskell/cereal
		dev-haskell/compact-string-fix
		dev-haskell/data-object
		dev-haskell/enumerator
		dev-haskell/monad-control
		dev-haskell/neither
		dev-haskell/network
		dev-haskell/path-pieces
		dev-haskell/pool
		dev-haskell/text
		>=dev-haskell/time-1.2
		dev-haskell/transformers
		>=dev-lang/ghc-6.10.1"
DEPEND="${RDEPEND}
		>=dev-haskell/cabal-1.8
		test? ( =dev-haskell/file-location-0.4*
			dev-haskell/hunit
			=dev-haskell/hspec-0.9*
			=dev-haskell/quickcheck-2.4*:2
		)"

PDEPEND="sqlite3? ( >=dev-haskell/hdbc-sqlite-${PV} )"

src_unpack() {
	git-2_src_unpack

	if use test; then
		pushd ${S}
		unpack "persistent-sqlite-${S_PV}.tar.gz"
		mv "persistent-sqlite-${S_PV}" "persistent-sqlite"
		unpack "persistent-template-${T_PV}.tar.gz"
		mv "persistent-template-${T_PV}" "persistent-template"
		popd
	fi
}

src_configure() {
	if use test; then
		CABAL_EXTRA_CONFIGURE_FLAGS="--enable-tests"
	fi
	cabal_src_configure
}
