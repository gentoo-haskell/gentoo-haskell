# Copyright 1999-2024 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=8

# ebuild generated by hackport 0.8.5.1.9999

CABAL_FEATURES="lib profile haddock hoogle hscolour test-suite"
inherit haskell-cabal

DESCRIPTION="Haskell interface to libarchive"
HOMEPAGE="https://hackage.haskell.org/package/libarchive"

LICENSE="BSD"
SLOT="0/${PV}"
KEYWORDS="~amd64"
IUSE="cross executable low-memory +system-libarchive"

CABAL_CHBINS=(
	'archive' 'hs-archive'
)

RDEPEND="
	>=dev-haskell/composition-prelude-2.0.5.0:=[profile?]
	dev-haskell/dlist:=[profile?]
	>=dev-haskell/unix-compat-0.1.2.1:=[profile?]
	>=dev-lang/ghc-9.0.2:=
	executable? (
		>=dev-haskell/bzlib-0.4:=[profile?] <dev-haskell/bzlib-0.7:=[profile?]
		dev-haskell/lzma-static:=[profile?]
		>=dev-haskell/zlib-0.6.2.2:=[profile?] <dev-haskell/zlib-0.7:=[profile?]
	)
	system-libarchive? (
		app-arch/libarchive
	)
"
DEPEND="${RDEPEND}
	>=dev-haskell/cabal-3.4.1.0 <=dev-haskell/cabal-4
	dev-haskell/chs-cabal
	test? ( dev-haskell/dir-traverse
		dev-haskell/hspec
		dev-haskell/pathological-bytestrings
		dev-haskell/temporary )
	!cross? ( >=dev-haskell/c2hs-0.26.1
			dev-haskell/cpphs )
	system-libarchive? ( virtual/pkgconfig )
"

src_configure() {
	local no-exe-flag="no-exe"
	use executable && no-exe-flag="-no-exe"

	local config_flags=(
		$(cabal_flag cross cross)
		$(cabal_flag low-memory low-memory)
		--flag=${no-exe-flag}
		$(cabal_flag system-libarchive system-libarchive)
	)

	haskell-cabal_src_configure "${config_flags[@]}"
}
